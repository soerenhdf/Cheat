local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- GUI Setup
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "CrashStarsMenu"
gui.ResetOnSpawn = false

-- Key Validation Frame
local keyRequested = true
local keyFrame = Instance.new("Frame", gui)
keyFrame.Size = UDim2.new(0, 260, 0, 150)
keyFrame.Position = UDim2.new(0.5, -130, 0.5, -75)
keyFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
keyFrame.Visible = true

local keyTitle = Instance.new("TextLabel", keyFrame)
keyTitle.Size = UDim2.new(1, 0, 0, 40)
keyTitle.Text = "Enter the key to proceed"
keyTitle.TextColor3 = Color3.new(1, 1, 1)
keyTitle.Font = Enum.Font.SourceSansBold
keyTitle.TextSize = 22
keyTitle.BackgroundTransparency = 1

-- Key Input (Password-like behavior)
local keyInput = Instance.new("TextBox", keyFrame)
keyInput.Size = UDim2.new(0, 220, 0, 30)
keyInput.Position = UDim2.new(0.5, -110, 0.5, -15)
keyInput.TextColor3 = Color3.new(1, 1, 1)
keyInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
keyInput.Font = Enum.Font.SourceSans
keyInput.TextSize = 18
keyInput.PlaceholderText = "Enter zhe key from crash_stars dc"
keyInput.TextTransparency = 1  -- Makes the text invisible

-- Enable password-like input behavior
keyInput.ClearTextOnFocus = false
keyInput.Text = ""
keyInput.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Keyboard then
        local text = keyInput.Text
        keyInput.Text = string.rep("*", #text)  -- Replace input with asterisks
    end
end)

local submitBtn = Instance.new("TextButton", keyFrame)
submitBtn.Size = UDim2.new(0, 100, 0, 30)
submitBtn.Position = UDim2.new(0.5, -50, 0.8, -15)
submitBtn.Text = "Submit"
submitBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
submitBtn.TextColor3 = Color3.new(1, 1, 1)
submitBtn.Font = Enum.Font.SourceSans
submitBtn.TextSize = 18
submitBtn.BorderSizePixel = 0

-- Menu Frame (Invisible until key is entered)
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 260, 0, 310)
frame.Position = UDim2.new(0.05, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.Active = true
frame.Draggable = true
frame.Visible = false

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "By Crash Stars"
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 22
title.BackgroundTransparency = 1

-- Button Actions
local flyEnabled = false
local tpEnabled = false
local wallhackEnabled = false
local flyConn
local wallhackParts = {}

-- Fly Functions
local function startFly()
    if flyEnabled then return end
    local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not root then return end
    local bv = Instance.new("BodyVelocity", root)
    bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    bv.Velocity = Vector3.zero
    bv.Name = "FlyVelocity"
    flyConn = RunService.RenderStepped:Connect(function()
        local move = Vector3.zero
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            move = Camera.CFrame.LookVector * (LocalPlayer.Character.Humanoid.MoveDirection.Magnitude > 0 and 100 or 0)
        end
        bv.Velocity = move
    end)
    flyEnabled = true
end

local function stopFly()
    if flyConn then flyConn:Disconnect() flyConn = nil end
    local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if root then
        local fly = root:FindFirstChild("FlyVelocity")
        if fly then fly:Destroy() end
    end
    flyEnabled = false
end

-- TP Aura Functions
local function startTPAura()
    tpEnabled = true
    local function tpToPlayer(player)
        if tpEnabled and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local targetPos = player.Character.HumanoidRootPart.Position + Vector3.new(math.random(-10, 10), 0, math.random(-10, 10))
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(targetPos)
        end
    end
    RunService.Heartbeat:Connect(function()
        if tpEnabled then
            local closestPlayer = nil
            local minDist = math.huge
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    local dist = (LocalPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                    if dist < minDist then
                        minDist = dist
                        closestPlayer = player
                    end
                end
            end
            if closestPlayer then
                tpToPlayer(closestPlayer)
            end
        end
    end)
end

local function stopTPAura()
    tpEnabled = false
end

-- Wallhack Functions
local function enableWallhack()
    for _, part in pairs(workspace:GetChildren()) do
        if part:IsA("BasePart") and part.CanCollide then
            local outline = Instance.new("SelectionBox", part)
            outline.Adornee = part
            outline.LineThickness = 0.1
            outline.Color3 = Color3.fromRGB(255, 0, 0)
            table.insert(wallhackParts, outline)
        end
    end
    workspace.ChildAdded:Connect(function(child)
        if child:IsA("BasePart") and child.CanCollide then
            local outline = Instance.new("SelectionBox", child)
            outline.Adornee = child
            outline.LineThickness = 0.1
            outline.Color3 = Color3.fromRGB(255, 0, 0)
            table.insert(wallhackParts, outline)
        end
    end)
    wallhackEnabled = true
end

local function disableWallhack()
    for _, outline in pairs(wallhackParts) do
        outline:Destroy()
    end
    wallhackEnabled = false
end

-- Button for Fly
local flyBtn = Instance.new("TextButton", frame)
flyBtn.Size = UDim2.new(0, 100, 0, 40)
flyBtn.Position = UDim2.new(0, 10, 0, 50)
flyBtn.Text = "Toggle Fly"
flyBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
flyBtn.TextColor3 = Color3.new(1, 1, 1)
flyBtn.Font = Enum.Font.SourceSansBold
flyBtn.TextSize = 18
flyBtn.MouseButton1Click:Connect(function()
    if flyEnabled then stopFly() else startFly() end
end)

-- Button for TP Aura
local tpBtn = Instance.new("TextButton", frame)
tpBtn.Size = UDim2.new(0, 100, 0, 40)
tpBtn.Position = UDim2.new(0, 10, 0, 100)
tpBtn.Text = "Toggle TP Aura"
tpBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
tpBtn.TextColor3 = Color3.new(1, 1, 1)
tpBtn.Font = Enum.Font.SourceSansBold
tpBtn.TextSize = 18
tpBtn.MouseButton1Click:Connect(function()
    if tpEnabled then stopTPAura() else startTPAura() end
end)

-- Button for Wallhack
local wallhackBtn = Instance.new("TextButton", frame)
wallhackBtn.Size = UDim2.new(0, 100, 0, 40)
wallhackBtn.Position = UDim2.new(0, 10, 0, 150)
wallhackBtn.Text = "Toggle Wallhack"
wallhackBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
wallhackBtn.TextColor3 = Color3.new(1, 1, 1)
wallhackBtn.Font = Enum.Font.SourceSansBold
wallhackBtn.TextSize = 18
wallhackBtn.MouseButton1Click:Connect(function()
    if wallhackEnabled then disableWallhack() else enableWallhack() end
end)

-- Minimize and Close Buttons
local minimizeBtn = Instance.new("TextButton", frame)
minimizeBtn.Size = UDim2.new(0, 25, 0, 25)
minimizeBtn.Position = UDim2.new(1, -60, 0, 5)
minimizeBtn.Text = "-"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
minimizeBtn.TextColor3 = Color3.new(1, 1, 1)
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 18

local closeBtn = Instance.new("TextButton", frame)
closeBtn.Size = UDim2.new(0, 25, 0, 25)
closeBtn.Position = UDim2.new(1, -30, 0, 5)
closeBtn.Text = "X"
closeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 18

-- Button Functions
minimizeBtn.MouseButton1Click:Connect(function()
    frame.Visible = false
end)

closeBtn.MouseButton1Click:Connect(function()
    gui:Destroy()
end)

-- Submit Button
submitBtn.MouseButton1Click:Connect(function()
    if keyInput.Text == "#crash-key" then
        keyRequested = false
        keyFrame.Visible = false
        frame.Visible = true
    else
        keyRequested = true
    end
end)

