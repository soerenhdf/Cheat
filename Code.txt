local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- GUI
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "CrashStarsMenu"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 250, 0, 300)
frame.Position = UDim2.new(0.05, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "By Crash Stars"
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 22
title.BackgroundTransparency = 1

local function createButton(name, yPos)
	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(1, -20, 0, 30)
	btn.Position = UDim2.new(0, 10, 0, yPos)
	btn.Text = name
	btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.SourceSans
	btn.TextSize = 18
	btn.BorderSizePixel = 0
	return btn
end

-- Fly
local flyEnabled = false
local flySpeed = 80
local flyConn
local function startFly()
	local character = LocalPlayer.Character
	if not character or not character:FindFirstChild("HumanoidRootPart") then return end

	local root = character.HumanoidRootPart
	local bodyVel = Instance.new("BodyVelocity")
	bodyVel.MaxForce = Vector3.new(1e5, 1e5, 1e5)
	bodyVel.Velocity = Vector3.zero
	bodyVel.Parent = root

	flyConn = RunService.RenderStepped:Connect(function()
		local moveDir = LocalPlayer:GetMouse().Hit.Position - root.Position
		bodyVel.Velocity = (Camera.CFrame.LookVector * flySpeed)
	end)

	flyEnabled = true
end

local function stopFly()
	if flyConn then flyConn:Disconnect() flyConn = nil end
	local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if root then
		for _, obj in ipairs(root:GetChildren()) do
			if obj:IsA("BodyVelocity") then
				obj:Destroy()
			end
		end
	end
	flyEnabled = false
end

-- TP Aura
local auraEnabled = false
local auraConn
local function startAura()
	auraEnabled = true
	auraConn = RunService.RenderStepped:Connect(function()
		local myChar = LocalPlayer.Character
		if not myChar or not myChar:FindFirstChild("HumanoidRootPart") then return end

		local root = myChar.HumanoidRootPart
		local closest, dist = nil, math.huge

		for _, plr in pairs(Players:GetPlayers()) do
			if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
				local d = (root.Position - plr.Character.HumanoidRootPart.Position).magnitude
				if d < dist then
					dist = d
					closest = plr
				end
			end
		end

		if closest and closest.Character then
			local pos = closest.Character.HumanoidRootPart.Position
			local offset = Vector3.new(math.random(-5,5), math.random(3,6), math.random(-5,5))
			root.CFrame = CFrame.new(pos + offset, pos)
		end
	end)
end

local function stopAura()
	if auraConn then auraConn:Disconnect() auraConn = nil end
	auraEnabled = false
end

-- Wallhack
local wallhackEnabled = false
local highlights = {}
local function startWallhack()
	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer and plr.Character then
			local highlight = Instance.new("BoxHandleAdornment")
			highlight.Adornee = plr.Character:FindFirstChild("HumanoidRootPart")
			highlight.AlwaysOnTop = true
			highlight.ZIndex = 5
			highlight.Size = Vector3.new(4, 5, 2)
			highlight.Color3 = Color3.fromRGB(255, 0, 0)
			highlight.Transparency = 0.3
			highlight.Parent = gui
			table.insert(highlights, highlight)
		end
	end
	wallhackEnabled = true
end

local function stopWallhack()
	for _, h in pairs(highlights) do h:Destroy() end
	highlights = {}
	wallhackEnabled = false
end

-- Buttons
local flyBtn = createButton("Toggle Fly", 50)
local auraBtn = createButton("Toggle TP Aura", 90)
local wallBtn = createButton("Toggle Wallhack", 130)

flyBtn.MouseButton1Click:Connect(function()
	if flyEnabled then stopFly() else startFly() end
end)

auraBtn.MouseButton1Click:Connect(function()
	if auraEnabled then stopAura() else startAura() end
end)

wallBtn.MouseButton1Click:Connect(function()
	if wallhackEnabled then stopWallhack() else startWallhack() end
end)

-- Minimize / Close
local minimizeButton = Instance.new("TextButton", frame)
minimizeButton.Size = UDim2.new(0, 25, 0, 25)
minimizeButton.Position = UDim2.new(1, -60, 0, 5)
minimizeButton.Text = "-"
minimizeButton.TextColor3 = Color3.new(1, 1, 1)
minimizeButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
minimizeButton.Font = Enum.Font.SourceSansBold
minimizeButton.TextSize = 18

local closeButton = Instance.new("TextButton", frame)
closeButton.Size = UDim2.new(0, 25, 0, 25)
closeButton.Position = UDim2.new(1, -30, 0, 5)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.new(1, 1, 1)
closeButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
closeButton.Font = Enum.Font.SourceSansBold
closeButton.TextSize = 18

-- Minimieren
minimizeButton.MouseButton1Click:Connect(function()
	frame.Visible = false
	local miniButton = Instance.new("TextButton", gui)
	miniButton.Name = "MiniButton"
	miniButton.Size = UDim2.new(0, 120, 0, 30)
	miniButton.Position = UDim2.new(0.1, 0, 0.9, 0)
	miniButton.Text = "Open Menu"
	miniButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	miniButton.TextColor3 = Color3.new(1, 1, 1)
	miniButton.Font = Enum.Font.SourceSansBold
	miniButton.TextSize = 18
	miniButton.Draggable = true
	miniButton.Active = true

	miniButton.MouseButton1Click:Connect(function()
		frame.Visible = true
		miniButton:Destroy()
	end)
end)

-- SchlieÃŸen
closeButton.MouseButton1Click:Connect(function()
	stopFly()
	stopAura()
	stopWallhack()
	gui:Destroy()
end)
