-- GUI erstellen
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local Toggle = Instance.new("TextButton", ScreenGui)
Toggle.Size = UDim2.new(0, 150, 0, 50)
Toggle.Position = UDim2.new(0, 20, 0, 150)
Toggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Toggle.TextColor3 = Color3.new(1, 1, 1)
Toggle.Text = "Start AI"
Toggle.TextScaled = true

local aiRunning = false
local player = game.Players.LocalPlayer
local pathfindingService = game:GetService("PathfindingService")
local espRadius = 3  -- ESP Umkreis auf 5 Studs ändern

local targetPosition = nil

-- Wenn der Spieler auf einen Punkt klickt
game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        targetPosition = workspace.CurrentCamera:ScreenToWorldPoint(Vector3.new(input.Position.X, input.Position.Y, 0))
        if targetPosition then
            -- Starte den Wegplanungsprozess
            startAI(targetPosition)
        end
    end
end)

-- KI starten, um zum Ziel zu gehen
local function startAI(target)
    aiRunning = true
    local path = pathfindingService:CreatePath({
        AgentRadius = 2,
        AgentHeight = 5,
        AgentCanJump = true,
        AgentJumpHeight = 10,
        AgentMaxSlope = 45,
    })

    -- Berechne den Pfad zum Ziel
    path:ComputeAsync(player.Character.HumanoidRootPart.Position, target)

    -- Bewege den Charakter entlang des Pfades
    path:MoveTo(player.Character)

    -- Wenn der Pfad abgeschlossen ist, stoppe die KI
    path.Completed:Wait()
    aiRunning = false
end

-- ESP für nahe Objekte
local function espObjectsInRange()
    for _, part in pairs(workspace:GetDescendants()) do
        if part:IsA("BasePart") and (part.Position - player.Character.HumanoidRootPart.Position).Magnitude < espRadius then
            -- Überprüfe, ob es nicht der Spieler ist
            if part.Parent ~= player.Character then
                local box = Instance.new("BoxHandleAdornment")
                box.Parent = part
                box.Adornee = part
                box.Size = part.Size + Vector3.new(0.2, 0.2, 0.2)
                box.Color3 = Color3.fromRGB(0, 255, 0) -- Grüner Rand
                box.AlwaysOnTop = true
            end
        end
    end
end

-- Stoppen der KI
local function stopAI()
    aiRunning = false
end

-- Button für das Starten/Stoppen der KI
Toggle.MouseButton1Click:Connect(function()
    if aiRunning then
        stopAI()
        Toggle.Text = "Start AI"
    else
        startAI(targetPosition)
        Toggle.Text = "Stop AI"
    end
end)

-- Update ESP in der Nähe
while true do
    espObjectsInRange()
    wait(0.5)  -- ESP alle 0.5 Sekunden aktualisieren
end
