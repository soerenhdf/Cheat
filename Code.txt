-- LocalScript in StarterGui

local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Services
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Fly Variablen
local flying = false
local flyVelocity
local flyGyro
local control = {F = 0, B = 0, L = 0, R = 0}

-- GUI erstellen
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FlyMenue"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 300, 0, 250)  -- Gr√∂√üe angepasst
frame.Position = UDim2.new(0.5, -150, 0.5, -125)  -- Position angepasst
frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)  -- Dunkelgrau f√ºr den Hintergrund
frame.BorderSizePixel = 2
frame.BorderColor3 = Color3.fromRGB(255, 255, 255)
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Text = "Fly Men√º"
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 24
title.Parent = frame

-- Fly-Button
local flyButton = Instance.new("TextButton")
flyButton.Size = UDim2.new(0.8, 0, 0, 40)
flyButton.Position = UDim2.new(0.1, 0, 0, 80)
flyButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
flyButton.Text = "üõ©Ô∏è Fly Mode: OFF"
flyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
flyButton.Font = Enum.Font.SourceSans
flyButton.TextSize = 20
flyButton.Parent = frame

-- Schlie√üen-Button oben rechts
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -35, 0, 5)
closeButton.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.SourceSansBold
closeButton.TextSize = 20
closeButton.Parent = frame

closeButton.MouseButton1Click:Connect(function()
	frame.Visible = false
end)

-- Discord Link Button oben
local discordButton = Instance.new("TextButton")
discordButton.Size = UDim2.new(0.8, 0, 0, 40)
discordButton.Position = UDim2.new(0.1, 0, 0, 40)
discordButton.BackgroundColor3 = Color3.fromRGB(40, 120, 250)
discordButton.Text = "Discord Join"
discordButton.TextColor3 = Color3.fromRGB(255, 255, 255)
discordButton.Font = Enum.Font.SourceSans
discordButton.TextSize = 20
discordButton.Parent = frame

discordButton.MouseButton1Click:Connect(function()
    -- √ñffnet den Discord-Link in einem Webbrowser
    local url = "https://discord.gg/Q2dqRDaJ4Q"
    game:GetService("GuiService"):OpenBrowserWindow(url)
end)

-- Fly Funktion
local function startFlying()
	if not flying then
		flying = true
		flyVelocity = Instance.new("BodyVelocity")
		flyVelocity.Velocity = Vector3.zero
		flyVelocity.MaxForce = Vector3.new(1e5, 1e5, 1e5)
		flyVelocity.Parent = humanoidRootPart

		flyGyro = Instance.new("BodyGyro")
		flyGyro.CFrame = humanoidRootPart.CFrame
		flyGyro.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
		flyGyro.P = 10000
		flyGyro.Parent = humanoidRootPart

		RunService:BindToRenderStep("Flying", Enum.RenderPriority.Character.Value, function()
			if flying then
				local cam = workspace.CurrentCamera
				local moveVec = (cam.CFrame.LookVector * control.F + -cam.CFrame.LookVector * control.B + -cam.CFrame.RightVector * control.L + cam.CFrame.RightVector * control.R)
				flyVelocity.Velocity = moveVec * 50
				flyGyro.CFrame = cam.CFrame
			end
		end)
	else
		print("Already flying!")
	end
end

local function stopFlying()
	flying = false
	if flyVelocity then flyVelocity:Destroy() end
	if flyGyro then flyGyro:Destroy() end
	RunService:UnbindFromRenderStep("Flying")
	print("Stopped flying")
end

-- Button klick f√ºr Fly
flyButton.MouseButton1Click:Connect(function()
	if flying then
		stopFlying()
		flyButton.Text = "üõ©Ô∏è Fly Mode: OFF"
	else
		startFlying()
		flyButton.Text = "üõ©Ô∏è Fly Mode: ON"
	end
end)

-- Tastatureingaben (WASD + O f√ºr Men√º)
UIS.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.KeyCode == Enum.KeyCode.W then control.F = 1 end
	if input.KeyCode == Enum.KeyCode.S then control.B = 1 end
	if input.KeyCode == Enum.KeyCode.A then control.L = 1 end
	if input.KeyCode == Enum.KeyCode.D then control.R = 1 end

	-- "O" zum Men√º anzeigen/verstecken
	if input.KeyCode == Enum.KeyCode.O then
		frame.Visible = not frame.Visible
	end
end)

UIS.InputEnded:Connect(function(input, gameProcessed)
	if input.KeyCode == Enum.KeyCode.W then control.F = 0 end
	if input.KeyCode == Enum.KeyCode.S then control.B = 0 end
	if input.KeyCode == Enum.KeyCode.A then control.L = 0 end
	if input.KeyCode == Enum.KeyCode.D then control.R = 0 end
end)

-- Virtuellen Joystick f√ºr mobile Steuerung erstellen
local mobileJoystick = Instance.new("Frame")
mobileJoystick.Size = UDim2.new(0, 150, 0, 150)
mobileJoystick.Position = UDim2.new(0, 50, 1, -200)
mobileJoystick.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
mobileJoystick.BorderSizePixel = 2
mobileJoystick.Parent = screenGui

local innerCircle = Instance.new("Frame")
innerCircle.Size = UDim2.new(0, 60, 0, 60)
innerCircle.Position = UDim2.new(0.5, -30, 0.5, -30)
innerCircle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
innerCircle.BorderSizePixel = 2
innerCircle.Parent = mobileJoystick

-- Steuerung per Touch auf mobilen Ger√§ten
local dragging = false
local initialPos = Vector2.zero

mobileJoystick.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		initialPos = input.Position
	end
end)

mobileJoystick.InputChanged:Connect(function(input)
	if dragging and input.UserInputType == Enum.UserInputType.Touch then
		local delta = input.Position - initialPos
		local moveX = math.clamp(delta.X / 75, -1, 1)
		local moveY = math.clamp(delta.Y / 75, -1, 1)
		
		control.L = -moveX
		control.R = moveX
		control.F = moveY
		control.B = -moveY
		
		innerCircle.Position = UDim2.new(0.5, delta.X, 0.5, delta.Y)
	end
end)

mobileJoystick.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		dragging = false
		control.L = 0
		control.R = 0
		control.F = 0
		control.B = 0
		innerCircle.Position = UDim2.new(0.5, -30, 0.5, -30)
	end
end)
