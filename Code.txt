local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- GUI Setup
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "CrashStarsMenu"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 260, 0, 310)
frame.Position = UDim2.new(0.05, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "By Crash Stars"
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 22
title.BackgroundTransparency = 1

-- Key Validation
local keyRequested = true
local keyFrame = Instance.new("Frame", gui)
keyFrame.Size = UDim2.new(0, 260, 0, 150)
keyFrame.Position = UDim2.new(0.05, 0, 0.2, 0)
keyFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
keyFrame.Visible = true

local keyTitle = Instance.new("TextLabel", keyFrame)
keyTitle.Size = UDim2.new(1, 0, 0, 40)
keyTitle.Text = "Enter the key to proceed"
keyTitle.TextColor3 = Color3.new(1, 1, 1)
keyTitle.Font = Enum.Font.SourceSansBold
keyTitle.TextSize = 22
keyTitle.BackgroundTransparency = 1

local keyInput = Instance.new("TextBox", keyFrame)
keyInput.Size = UDim2.new(0, 220, 0, 30)
keyInput.Position = UDim2.new(0.5, -110, 0.5, -15)
keyInput.TextColor3 = Color3.new(1, 1, 1)
keyInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
keyInput.Font = Enum.Font.SourceSans
keyInput.TextSize = 18
keyInput.PlaceholderText = "Enter #crash-key"

local submitBtn = Instance.new("TextButton", keyFrame)
submitBtn.Size = UDim2.new(0, 100, 0, 30)
submitBtn.Position = UDim2.new(0.5, -50, 0.8, -15)
submitBtn.Text = "Submit"
submitBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
submitBtn.TextColor3 = Color3.new(1, 1, 1)
submitBtn.Font = Enum.Font.SourceSans
submitBtn.TextSize = 18
submitBtn.BorderSizePixel = 0

submitBtn.MouseButton1Click:Connect(function()
    if keyInput.Text == "#crash-key" then
        keyRequested = false
        keyFrame.Visible = false
        print("Access granted!")
    else
        keyInput.Text = ""
        keyInput.PlaceholderText = "Invalid key, try again!"
    end
end)

-- GUI Buttons (fly, TP aura, wallhack)
local flyEnabled = false
local flyConn
local function startFly()
	if flyEnabled then return end
	local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if not root then return end
	local bv = Instance.new("BodyVelocity", root)
	bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
	bv.Velocity = Vector3.zero
	bv.Name = "FlyVelocity"
	flyConn = RunService.RenderStepped:Connect(function()
		local move = Vector3.zero
		if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
			move = Camera.CFrame.LookVector * (LocalPlayer.Character.Humanoid.MoveDirection.Magnitude > 0 and 100 or 0)
		end
		bv.Velocity = move
	end)
	flyEnabled = true
end

local function stopFly()
	if flyConn then flyConn:Disconnect() flyConn = nil end
	local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if root then
		local fly = root:FindFirstChild("FlyVelocity")
		if fly then fly:Destroy() end
	end
	flyEnabled = false
end

-- TP Aura
local auraEnabled = false
local auraConn
local function startAura()
	if auraEnabled then return end
	auraEnabled = true
	auraConn = RunService.RenderStepped:Connect(function()
		local myChar = LocalPlayer.Character
		if not myChar or not myChar:FindFirstChild("HumanoidRootPart") then return end
		local root = myChar.HumanoidRootPart

		local closest, dist = nil, math.huge
		for _, plr in ipairs(Players:GetPlayers()) do
			if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
				local d = (root.Position - plr.Character.HumanoidRootPart.Position).Magnitude
				if d < dist then
					closest = plr
					dist = d
				end
			end
		end

		if closest then
			local pos = closest.Character.HumanoidRootPart.Position
			local offset = Vector3.new(math.random(-12,12), math.random(6,10), math.random(-12,12))
			root.CFrame = CFrame.new(pos + offset, pos)
		end
	end)
end

local function stopAura()
	if auraConn then auraConn:Disconnect() auraConn = nil end
	auraEnabled = false
end

-- Wallhack
local wallhackEnabled = false
local highlights = {}
local function startWallhack()
	if wallhackEnabled then return end
	wallhackEnabled = true
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local box = Instance.new("BoxHandleAdornment")
			box.Adornee = plr.Character.HumanoidRootPart
			box.AlwaysOnTop = true
			box.ZIndex = 5
			box.Size = Vector3.new(4,5,2)
			box.Color3 = Color3.fromRGB(255,0,0)
			box.Transparency = 0.3
			box.Parent = gui
			table.insert(highlights, box)
		end
	end
end

local function stopWallhack()
	for _, box in ipairs(highlights) do box:Destroy() end
	highlights = {}
	wallhackEnabled = false
end

-- Buttons
local flyBtn = createButton("Toggle Fly", 50)
flyBtn.MouseButton1Click:Connect(function()
	if flyEnabled then stopFly() else startFly() end
end)

local auraBtn = createButton("Toggle TP Aura", 90)
auraBtn.MouseButton1Click:Connect(function()
	if auraEnabled then stopAura() else startAura() end
end)

local wallBtn = createButton("Toggle Wallhack", 130)
wallBtn.MouseButton1Click:Connect(function()
	if wallhackEnabled then stopWallhack() else startWallhack() end
end)

-- Minimieren / Schließen
local minimizeBtn = Instance.new("TextButton", frame)
minimizeBtn.Size = UDim2.new(0, 25, 0, 25)
minimizeBtn.Position = UDim2.new(1, -60, 0, 5)
minimizeBtn.Text = "-"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
minimizeBtn.TextColor3 = Color3.new(1,1,1)
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 18

local closeBtn = Instance.new("TextButton", frame)
closeBtn.Size = UDim2.new(0, 25, 0, 25)
closeBtn.Position = UDim2.new(1, -30, 0, 5)
closeBtn.Text = "X"
closeBtn.BackgroundColor3 = Color3.fromRGB(150,0,0)
closeBtn.TextColor3 = Color3.new(1,1,1)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 18

-- Mini-Button (für minimierten Zustand)
local miniButton

minimizeBtn.MouseButton1Click:Connect(function()
	frame.Visible = false
	miniButton = Instance.new("TextButton", gui)
	miniButton.Size = UDim2.new(0, 120, 0, 30)
	miniButton.Position = UDim2.new(0.1, 0, 0.9, 0)
	miniButton.Text = "Open Menu"
	miniButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	miniButton.TextColor3 = Color3.new(1,1,1)
	miniButton.Font = Enum.Font.SourceSansBold
	miniButton.TextSize = 18
	miniButton.Draggable = true
	miniButton.Active = true

	miniButton.MouseButton1Click:Connect(function()
		frame.Visible = true
		miniButton:Destroy()
	end)
end)

closeBtn.MouseButton1Click:Connect(function()
	stopFly()
	stopAura()
	stopWallhack()
	gui:Destroy()
end)

